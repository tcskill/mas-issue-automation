
name: Automate Issue Creation2
on: [workflow_dispatch]
#  schedule:
#    - cron: '0 7 * * *'

jobs:
  check_release:
    name: Check For Release
    runs-on: ubuntu-latest
    permissions: write-all
    steps:
    
    #get notifications data (defaults to unread notifications only)
      - name: Get Notification Data
        run: |
          curl -H "Accept: application/vnd.github+json" \
          -H "Authorization: Bearer ${{ secrets.NOTIFICATION_CHECKER }}" \
          https://api.github.com/notifications -o data.json
          
    #check for release within target repository
    #if a release is found, create and issue and mark notification as read

      - name: Check Notification
        id: notif-check
        shell: bash
        run: |

          # exploit the JMESpath length() function to get a count of list elements to iterate
          COUNT=$(`cat data.json | jp "length( [*] )"`)

          # The `seq` command produces the sequence `0 1 2` for our indexes
          # The $(( )) operator in bash produces an arithmetic result ($COUNT minus one)
          for i in `seq 0 $((COUNT - 1))` ; do

              # The list elements in JMESpath are zero-indexed
              echo $1
              type=($(cat data.json | jp "[$i].subect.type"))
              echo $type

              # Add or replace whatever operation you like here.

          done